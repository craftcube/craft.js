(function(){angular.module("validation.rule",["validation"]).config(["$validationProvider",function(e){var t={nothing:function(){return!0},required:function(e){return!!e},url:/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/,email:/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/,number:/^\d+$/,minlength:function(e,t,n,i,r){return e&&e.length>=r},maxlength:function(e,t,n,i,r){return!e||e.length<=r}},n={nothing:{error:"Nothing happend!!",success:"&nbsp;"},required:{error:"此项必填!!",success:"&nbsp;"},url:{error:"url格式有误",success:"&nbsp;"},email:{error:"email格式有误",success:"&nbsp;"},number:{error:"此项应为数字",success:"&nbsp;"},minlength:{error:"未达最小长度",success:"&nbsp;"},maxlength:{error:"超过最大长度",success:"&nbsp;"}};e.setExpression(t).setDefaultMsg(n)}])}).call(this),angular.module("validation",["validation.provider","validation.directive"]),angular.module("validation.provider",[]),angular.module("validation.directive",["validation.provider"]),function(){function e(){var e,t,n,i,r,s=this,a=function(s){e=s,t=e.get("$rootScope"),n=e.get("$http"),i=e.get("$q"),r=e.get("$timeout")},o={},l=null,u={};this.setExpression=function(e){return angular.extend(o,e),s},this.getExpression=function(e){return o[e]},this.setDefaultMsg=function(e){return angular.extend(u,e),s},this.getDefaultMsg=function(e){return u[e]},this.setValidMethod=function(e){l=e},this.getValidMethod=function(){return l},this.setErrorHTML=function(e){if(e.constructor===Function)return s.getErrorHTML=e,s},this.getErrorHTML=function(e){return'<p class="validation-invalid">'+e+"</p>"},this.setSuccessHTML=function(e){if(e.constructor===Function)return s.getSuccessHTML=e,s},this.getSuccessHTML=function(e){return'<p class="validation-valid">'+e+"</p>"},this.showSuccessMessage=!0,this.showErrorMessage=!0,this.checkValid=function(e){return!(!e||!e.$valid)},this.validate=function(e){var n=i.defer(),a=0;if(void 0===e)return console.error("This is not a regular Form name scope"),n.reject("This is not a regular Form name scope"),n.promise;if(e.validationId)t.$broadcast(e.$name+"submit-"+e.validationId,a++);else if(e.constructor===Array)for(var o in e)t.$broadcast(e[o].$name+"submit-"+e[o].validationId,a++);else for(var l in e)"$"!==l[0]&&e[l].hasOwnProperty("$dirty")&&t.$broadcast(l+"submit-"+e[l].validationId,a++);return n.promise.success=function(e){return n.promise.then(function(t){e(t)}),n.promise},n.promise.error=function(e){return n.promise.then(null,function(t){e(t)}),n.promise},r(function(){s.checkValid(e)?n.resolve("success"):n.reject("error")}),n.promise},this.validCallback=null,this.invalidCallback=null,this.resetCallback=null,this.reset=function(e){if(void 0===e)return void console.error("This is not a regular Form name scope");if(e.validationId)t.$broadcast(e.$name+"reset-"+e.validationId);else if(e.constructor===Array)for(var n in e)t.$broadcast(e[n].$name+"reset-"+e[n].validationId);else for(var i in e)"$"!==i[0]&&e[i].hasOwnProperty("$dirty")&&t.$broadcast(i+"reset-"+e[i].validationId)},this.addMsgElement=function(e){return e.after("<span></span>")},this.getMsgElement=function(e){return e.next()},this.$get=["$injector",function(e){return a(e),{setValidMethod:this.setValidMethod,getValidMethod:this.getValidMethod,setErrorHTML:this.setErrorHTML,getErrorHTML:this.getErrorHTML,setSuccessHTML:this.setSuccessHTML,getSuccessHTML:this.getSuccessHTML,setExpression:this.setExpression,getExpression:this.getExpression,setDefaultMsg:this.setDefaultMsg,getDefaultMsg:this.getDefaultMsg,showSuccessMessage:this.showSuccessMessage,showErrorMessage:this.showErrorMessage,checkValid:this.checkValid,validate:this.validate,validCallback:this.validCallback,invalidCallback:this.invalidCallback,resetCallback:this.resetCallback,reset:this.reset,addMsgElement:this.addMsgElement,getMsgElement:this.getMsgElement}}]}angular.module("validation.provider").provider("$validation",e)}.call(this),function(){function e(e){var t=e.get("$validation"),n=e.get("$timeout"),i=e.get("$parse");return{link:function(e,r,s){var a=i(s.validationReset)(e);n(function(){r.on("click",function(e){e.preventDefault(),t.reset(a)})})}}}angular.module("validation.directive").directive("validationReset",e),e.$inject=["$injector"]}.call(this),function(){function e(e){var t=e.get("$validation"),n=e.get("$timeout"),i=e.get("$parse");return{priority:1,require:"?ngClick",link:function(e,r,s){var a=i(s.validationSubmit)(e);n(function(){r.off("click"),r.on("click",function(n){n.preventDefault(),t.validate(a).success(function(){i(s.ngClick)(e)})})})}}}angular.module("validation.directive").directive("validationSubmit",e),e.$inject=["$injector"]}.call(this),function(){function e(e){function t(e,t,n){for(var i=document.querySelectorAll("*[validation-group="+t+"]"),r=0,s=i.length;r<s;r++){var a=i[r],o=a.form.name,l=a.name;e[o][l].$setValidity(l,n)}}function n(e){var t={};return e&&e.length>0?(t=e[0],angular.isObject(t)||(t={result:t,message:""})):t={result:!1,message:""},t}var i=e.get("$validation"),r=e.get("$q"),s=e.get("$timeout"),a=e.get("$compile"),o=e.get("$parse"),l={},u=function(e,t,n,r,s,l,u){var c,d=t||i.getDefaultMsg(n).success,g=o(l.validCallback),v=l.messageId,f=l.validationGroup;return c=v||f?angular.element(document.querySelector("#"+(v||f))):i.getMsgElement(e),"nothing"===n?c.css("display","none"):e.attr("no-validation-message")?c.css("display","none"):i.showSuccessMessage&&d?(d=angular.isFunction(d)?d(e,l,u):d,c.html("").append(a(i.getSuccessHTML(d,e,l))(r)),c.css("display","")):c.css("display","none"),s.$setValidity(s.$name,!0),g(r,{message:d}),i.validCallback&&i.validCallback(e),!0},c=function(e,t,n,r,s,l,u){var c,d=t||i.getDefaultMsg(n).error,g=o(l.invalidCallback),v=l.messageId,f=l.validationGroup;return c=v||f?angular.element(document.querySelector("#"+(v||f))):i.getMsgElement(e),e.attr("no-validation-message")?c.css("display","none"):i.showErrorMessage&&d?(d=angular.isFunction(d)?d(e,l,u):d,c.html("").append(a(i.getErrorHTML(d,e,l))(r)),c.css("display","")):c.css("display","none"),s.$setValidity(s.$name,!1),g(r,{message:d}),i.invalidCallback&&i.invalidCallback(e),!1},d=function(e){var t=l[e];return Object.keys(t).some(function(e){return t[e]})},g={},v=function(e,s,a,o,g,f){var m=g.slice(0),h=m[0].trim(),$=h.indexOf("="),p=$===-1?h:h.substr(0,$),M=$===-1?null:h.substr($+1),b=m.slice(1),y=p+"SuccessMessage",E=p+"ErrorMessage",k=i.getExpression(p),V=a.validationGroup,w={success:function(t){return u(s,t||a[y],p,e,o,a,M),!b.length||v(e,s,a,o,b,f)},error:function(t){return c(s,t||a[E],p,e,o,a,M)}};if(void 0===k)return u(s,"","nothing",e,o,a,M),!0;if(k.constructor===Function)return r.all([i.getExpression(p)(f,e,s,a,M)]).then(function(i){var r=n(i),s=r.message;return r.result?(V&&(l[V][o.$name]=!0,t(e,V,!0)),w.success(s)):V?(l[V][o.$name]=!1,d(V)?void t(e,V,!0):(t(e,V,!1),w.error(s))):w.error(s)},function(){return w.error()});if(k.constructor!==RegExp)return w.error();if(void 0!==f&&null!==f){if(i.getExpression(p).test(f))return V&&(l[V][o.$name]=!0,t(e,V,!0)),w.success();if(!V)return w.error();if(l[V][o.$name]=!1,!d(V))return t(e,V,!1),w.error();t(e,V,!0)}},f=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},m=function(){return f()+f()+f()+f()};return{restrict:"A",require:"ngModel",link:function(e,t,n,r){var a="false"!==n.useViewValue,o=n.validator,u=n.messageId,c=n.validationGroup,d=n.validMethod,f=n.ngModel,h=function(){},$=o.split(","),p=r.validationId=m(),M=null,b=void 0;return"boolean"==typeof n.initialValidity&&(b=n.initialValidity),n.$observe("validator",function(e){$=e.split(",")}),c&&(l[c]||(l[c]={}),l[c][r.$name]=!1),u||c||i.addMsgElement(t),r.$setValidity(r.$name,b),e.$on(r.$name+"reset-"+p,function(){h(),s(function(){r.$setViewValue(M),r.$setPristine(),r.$setValidity(r.$name,void 0),r.$render(),u||c?angular.element(document.querySelector("#"+(u||c))).html(""):i.getMsgElement(t).html(""),i.resetCallback&&i.resetCallback(t)})}),d=angular.isUndefined(d)?i.getValidMethod():d,e.$on(r.$name+"submit-"+p,function(i,o){var l=a?r.$viewValue:r.$modelValue,u=!1;u=v(e,t,n,r,$,l),"submit"===d&&(h(),h=e.$watch(function(){return e.$eval(f)},function(i,s){i!==s&&(void 0!==i&&null!==i||(i=""),u=v(e,t,n,r,$,i))}));var c=function(e){e?delete g[o]:(g[o]=t[0],s(function(){g[Math.min.apply(null,Object.keys(g))].focus()},0))};u.constructor===Object?u.then(c):c(u)}),"blur"===d?void t.bind("blur",function(){var i=e.$eval(f);"$apply"!==e.$root.$$phase?e.$apply(function(){v(e,t,n,r,$,i)}):v(e,t,n,r,$,i)}):void("submit"!==d&&"submit-only"!==d&&(e.$watch(function(){return e.$eval(f)},function(s){if(r.$pristine&&r.$viewValue)M=r.$viewValue||"",r.$setViewValue(r.$viewValue);else if(r.$pristine)return void(u||c?angular.element(document.querySelector("#"+(u||c))).html(""):i.getMsgElement(t).html(""));v(e,t,n,r,$,s)}),s(function(){n.$observe("noValidationMessage",function(e){var n;n=u||c?angular.element(document.querySelector("#"+(u||c))):i.getMsgElement(t),"true"===e||e===!0?n.css("display","none"):"false"!==e&&e!==!1||n.css("display","block")})})))}}}angular.module("validation.directive").directive("validator",e),e.$inject=["$injector"]}.call(this);