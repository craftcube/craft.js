(function(){"use strict";function e(e,r){return{notLogonHandler:function(){r.create({className:"danger",content:"未登录,请登录"}),e.go("auth.login",{location:!0,reload:!0})},errorLogonHandler:function(e){r.create({className:"danger",content:"登录失败"+e})},toastError:function(e){r.create({className:"danger",content:e.errMsg})}}}angular.module("craft.auth.handler",["craft.widgets.toast"]),angular.module("craft.auth.handler").factory("AuthHandlerService",e),e.$inject=["$state","ngToast"]}).call(this),function(){"use strict";function e(e,r,t,n,o,a){var u=angular.extend({});return u.isLoggedIn=function(){var r=e.retrieve(),r=JSON.parse(e.retrieve());return!!r},u.currentUser=function(){if(this.isLoggedIn())return e.retrieve()},u.logon=function(u,c){var i=r.defer(),s=t.getAppConfig().RootPath+"/logon",l="userName="+u+"&password="+c;return a.post(s,l).then(function(r){n.service("userService","getUserInfo").then(function(r){e.create(r),o.go("home.default",{location:!0,reload:!0})},function(e){console.log(e)}),i.resolve("logon success")},function(e){i.reject(e)}),i.promise},u.logout=function(){var r=t.getAppConfig().RootPath+"/logout";a["delete"](r).then(function(e){}),e.destroy(),o.go("auth.login",{location:!0,reload:!0})},u}angular.module("craft.auth.AuthService",["craft.api.cap","craft.auth.handler"]),angular.module("craft.auth.AuthService").factory("SessionAuthService",e),e.$inject=["UserStorage","$q","ConfigService","CrudService","$state","HttpService"]}.call(this),function(){"use strict";function e(e,t,n,o){e.login=function(){return e.user&&e.user.username?e.user.password?void t.logon(e.user.username,r(e.user.password)).then(function(){o.create("登录成功")},function(e){n.errorLogonHandler(e)}):void alert("请填写密码"):void alert("请填写用户名")},e.isLoggedIn=function(){return t.isLoggedIn()},e.currentUser=function(){return t.currentUser()},e.logout=function(){t.logout()}}function r(e){function r(e,r){return e<<r|e>>>32-r}function t(e,r){var t,n,o,a,u;return o=2147483648&e,a=2147483648&r,t=1073741824&e,n=1073741824&r,u=(1073741823&e)+(1073741823&r),t&n?2147483648^u^o^a:t|n?1073741824&u?3221225472^u^o^a:1073741824^u^o^a:u^o^a}function n(e,r,t){return e&r|~e&t}function o(e,r,t){return e&t|r&~t}function a(e,r,t){return e^r^t}function u(e,r,t){return r^(e|~t)}function c(e,o,a,u,c,i,s){return e=t(e,t(t(n(o,a,u),c),s)),t(r(e,i),o)}function i(e,n,a,u,c,i,s){return e=t(e,t(t(o(n,a,u),c),s)),t(r(e,i),n)}function s(e,n,o,u,c,i,s){return e=t(e,t(t(a(n,o,u),c),s)),t(r(e,i),n)}function l(e,n,o,a,c,i,s){return e=t(e,t(t(u(n,o,a),c),s)),t(r(e,i),n)}function f(e){for(var r,t=e.length,n=t+8,o=(n-n%64)/64,a=16*(o+1),u=Array(a-1),c=0,i=0;i<t;)r=(i-i%4)/4,c=i%4*8,u[r]=u[r]|e.charCodeAt(i)<<c,i++;return r=(i-i%4)/4,c=i%4*8,u[r]=u[r]|128<<c,u[a-2]=t<<3,u[a-1]=t>>>29,u}function g(e){var r,t,n="",o="";for(t=0;t<=3;t++)r=e>>>8*t&255,o="0"+r.toString(16),n+=o.substr(o.length-2,2);return n}function d(e){e=e.replace(/\r\n/g,"\n");for(var r="",t=0;t<e.length;t++){var n=e.charCodeAt(t);n<128?r+=String.fromCharCode(n):n>127&&n<2048?(r+=String.fromCharCode(n>>6|192),r+=String.fromCharCode(63&n|128)):(r+=String.fromCharCode(n>>12|224),r+=String.fromCharCode(n>>6&63|128),r+=String.frameElement(63&n|128))}return r}var h,v,S,m,p,C,A,I,L,$=Array(),U=7,H=12,y=17,w=22,N=5,j=9,P=14,E=20,J=4,O=11,R=16,T=23,b=6,q=10,x=15,D=21;for(e=d(e),$=f(e),C=1732584193,A=4023233417,I=2562383102,L=271733878,h=0;h<$.length;h+=16)v=C,S=A,m=I,p=L,C=c(C,A,I,L,$[h+0],U,3614090360),L=c(L,C,A,I,$[h+1],H,3905402710),I=c(I,L,C,A,$[h+2],y,606105819),A=c(A,I,L,C,$[h+3],w,3250441966),C=c(C,A,I,L,$[h+4],U,4118548399),L=c(L,C,A,I,$[h+5],H,1200080426),I=c(I,L,C,A,$[h+6],y,2821735955),A=c(A,I,L,C,$[h+7],w,4249261313),C=c(C,A,I,L,$[h+8],U,1770035416),L=c(L,C,A,I,$[h+9],H,2336552879),I=c(I,L,C,A,$[h+10],y,4294925233),A=c(A,I,L,C,$[h+11],w,2304563134),C=c(C,A,I,L,$[h+12],U,1804603682),L=c(L,C,A,I,$[h+13],H,4254626195),I=c(I,L,C,A,$[h+14],y,2792965006),A=c(A,I,L,C,$[h+15],w,1236535329),C=i(C,A,I,L,$[h+1],N,4129170786),L=i(L,C,A,I,$[h+6],j,3225465664),I=i(I,L,C,A,$[h+11],P,643717713),A=i(A,I,L,C,$[h+0],E,3921069994),C=i(C,A,I,L,$[h+5],N,3593408605),L=i(L,C,A,I,$[h+10],j,38016083),I=i(I,L,C,A,$[h+15],P,3634488961),A=i(A,I,L,C,$[h+4],E,3889429448),C=i(C,A,I,L,$[h+9],N,568446438),L=i(L,C,A,I,$[h+14],j,3275163606),I=i(I,L,C,A,$[h+3],P,4107603335),A=i(A,I,L,C,$[h+8],E,1163531501),C=i(C,A,I,L,$[h+13],N,2850285829),L=i(L,C,A,I,$[h+2],j,4243563512),I=i(I,L,C,A,$[h+7],P,1735328473),A=i(A,I,L,C,$[h+12],E,2368359562),C=s(C,A,I,L,$[h+5],J,4294588738),L=s(L,C,A,I,$[h+8],O,2272392833),I=s(I,L,C,A,$[h+11],R,1839030562),A=s(A,I,L,C,$[h+14],T,4259657740),C=s(C,A,I,L,$[h+1],J,2763975236),L=s(L,C,A,I,$[h+4],O,1272893353),I=s(I,L,C,A,$[h+7],R,4139469664),A=s(A,I,L,C,$[h+10],T,3200236656),C=s(C,A,I,L,$[h+13],J,681279174),L=s(L,C,A,I,$[h+0],O,3936430074),I=s(I,L,C,A,$[h+3],R,3572445317),A=s(A,I,L,C,$[h+6],T,76029189),C=s(C,A,I,L,$[h+9],J,3654602809),L=s(L,C,A,I,$[h+12],O,3873151461),I=s(I,L,C,A,$[h+15],R,530742520),A=s(A,I,L,C,$[h+2],T,3299628645),C=l(C,A,I,L,$[h+0],b,4096336452),L=l(L,C,A,I,$[h+7],q,1126891415),I=l(I,L,C,A,$[h+14],x,2878612391),A=l(A,I,L,C,$[h+5],D,4237533241),C=l(C,A,I,L,$[h+12],b,1700485571),L=l(L,C,A,I,$[h+3],q,2399980690),I=l(I,L,C,A,$[h+10],x,4293915773),A=l(A,I,L,C,$[h+1],D,2240044497),C=l(C,A,I,L,$[h+8],b,1873313359),L=l(L,C,A,I,$[h+15],q,4264355552),I=l(I,L,C,A,$[h+6],x,2734768916),A=l(A,I,L,C,$[h+13],D,1309151649),C=l(C,A,I,L,$[h+4],b,4149444226),L=l(L,C,A,I,$[h+11],q,3174756917),I=l(I,L,C,A,$[h+2],x,718787259),A=l(A,I,L,C,$[h+9],D,3951481745),C=t(C,v),A=t(A,S),I=t(I,m),L=t(L,p);return(g(C)+g(A)+g(I)+g(L)).toLowerCase()}angular.module("craft.auth.session",["craft.auth.handler","craft.auth.AuthService","craft.auth.UserStorage","craft.widgets.toast"]),angular.module("craft.auth.session").run(["$rootScope","$state","AuthHandlerService","SessionAuthService",function(e,r,t,n){e.$on("$stateChangeStart",function(e,r){n.isLoggedIn()||null!==r["protected"]&&r["protected"]===!0&&(e.preventDefault(),t.notLogonHandler())})}]),angular.module("craft.auth.session").controller("UserProfileCtrl",["$scope","SessionAuthService","AuthHandlerService","ngToast",e])}.call(),function(){"use strict";angular.module("craft.auth.UserStorage",[]).service("UserStorage",function(){this.create=function(e){localStorage.setItem("user",JSON.stringify(e))},this.retrieve=function(){return localStorage.getItem("user")},this.destroy=function(){localStorage.removeItem("user"),localStorage.removeItem("menu")}})}.call(this);