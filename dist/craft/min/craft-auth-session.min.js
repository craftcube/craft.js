(function(){"use strict";function r(r,t){return{notLogonHandler:function(){t.create({className:"danger",content:"未登录,请登录"}),r.go("auth.login",{location:!0,reload:!0})},errorLogonHandler:function(r){t.create({className:"danger",content:"登录失败"+r})}}}angular.module("craft.auth.handler",["craft.widgets.toast"]),angular.module("craft.auth.handler").factory("AuthHandlerService",r),r.$inject=["$state","ngToast"]}).call(this),function(){"use strict";function r(r,t,e,n,o,a){var u=angular.extend({});return u.isLoggedIn=function(){var t=r.retrieve(),t=JSON.parse(r.retrieve());return!!t},u.currentUser=function(){if(this.isLoggedIn())return r.retrieve()},u.logon=function(u,c){var i=t.defer(),s=e.getAppConfig().RootPath+"/logon",f={userName:u,password:c},l="params="+JSON.stringify(f);return a.post(s,l).then(function(t){n.service("userService","getUserInfo").then(function(t){r.create(t),o.go("home.default",{location:!0,reload:!0})},function(r){console.log(r)}),i.resolve("logon success")},function(r){i.reject(r)}),i.promise},u.logout=function(){var t=e.getAppConfig().RootPath+"/logout";a["delete"](t).then(function(r){}),r.destroy(),o.go("auth.login",{location:!0,reload:!0})},u}angular.module("craft.auth.AuthService",["craft.api.cap","craft.auth.handler"]),angular.module("craft.auth.AuthService").factory("SessionAuthService",r),r.$inject=["UserStorage","$q","ConfigService","CrudService","$state","HttpService"]}.call(this),function(){"use strict";function r(r,e,n,o){r.login=function(){return r.user&&r.user.username?r.user.password?void e.logon(r.user.username,t(r.user.password)).then(function(){o.create("登录成功")},function(r){n.errorLogonHandler(r)}):void alert("请填写密码"):void alert("请填写用户名")},r.isLoggedIn=function(){return e.isLoggedIn()},r.currentUser=function(){return e.currentUser()},r.logout=function(){e.logout()}}function t(r){function t(r,t){return r<<t|r>>>32-t}function e(r,t){var e,n,o,a,u;return o=2147483648&r,a=2147483648&t,e=1073741824&r,n=1073741824&t,u=(1073741823&r)+(1073741823&t),e&n?2147483648^u^o^a:e|n?1073741824&u?3221225472^u^o^a:1073741824^u^o^a:u^o^a}function n(r,t,e){return r&t|~r&e}function o(r,t,e){return r&e|t&~e}function a(r,t,e){return r^t^e}function u(r,t,e){return t^(r|~e)}function c(r,o,a,u,c,i,s){return r=e(r,e(e(n(o,a,u),c),s)),e(t(r,i),o)}function i(r,n,a,u,c,i,s){return r=e(r,e(e(o(n,a,u),c),s)),e(t(r,i),n)}function s(r,n,o,u,c,i,s){return r=e(r,e(e(a(n,o,u),c),s)),e(t(r,i),n)}function f(r,n,o,a,c,i,s){return r=e(r,e(e(u(n,o,a),c),s)),e(t(r,i),n)}function l(r){for(var t,e=r.length,n=e+8,o=(n-n%64)/64,a=16*(o+1),u=Array(a-1),c=0,i=0;i<e;)t=(i-i%4)/4,c=i%4*8,u[t]=u[t]|r.charCodeAt(i)<<c,i++;return t=(i-i%4)/4,c=i%4*8,u[t]=u[t]|128<<c,u[a-2]=e<<3,u[a-1]=e>>>29,u}function g(r){var t,e,n="",o="";for(e=0;e<=3;e++)t=r>>>8*e&255,o="0"+t.toString(16),n+=o.substr(o.length-2,2);return n}function d(r){r=r.replace(/\r\n/g,"\n");for(var t="",e=0;e<r.length;e++){var n=r.charCodeAt(e);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.frameElement(63&n|128))}return t}var h,v,S,m,p,C,A,L,$,I=Array(),U=7,y=12,H=17,w=22,N=5,j=9,J=14,O=20,P=4,R=11,T=16,b=23,q=6,x=10,D=15,E=21;for(r=d(r),I=l(r),C=1732584193,A=4023233417,L=2562383102,$=271733878,h=0;h<I.length;h+=16)v=C,S=A,m=L,p=$,C=c(C,A,L,$,I[h+0],U,3614090360),$=c($,C,A,L,I[h+1],y,3905402710),L=c(L,$,C,A,I[h+2],H,606105819),A=c(A,L,$,C,I[h+3],w,3250441966),C=c(C,A,L,$,I[h+4],U,4118548399),$=c($,C,A,L,I[h+5],y,1200080426),L=c(L,$,C,A,I[h+6],H,2821735955),A=c(A,L,$,C,I[h+7],w,4249261313),C=c(C,A,L,$,I[h+8],U,1770035416),$=c($,C,A,L,I[h+9],y,2336552879),L=c(L,$,C,A,I[h+10],H,4294925233),A=c(A,L,$,C,I[h+11],w,2304563134),C=c(C,A,L,$,I[h+12],U,1804603682),$=c($,C,A,L,I[h+13],y,4254626195),L=c(L,$,C,A,I[h+14],H,2792965006),A=c(A,L,$,C,I[h+15],w,1236535329),C=i(C,A,L,$,I[h+1],N,4129170786),$=i($,C,A,L,I[h+6],j,3225465664),L=i(L,$,C,A,I[h+11],J,643717713),A=i(A,L,$,C,I[h+0],O,3921069994),C=i(C,A,L,$,I[h+5],N,3593408605),$=i($,C,A,L,I[h+10],j,38016083),L=i(L,$,C,A,I[h+15],J,3634488961),A=i(A,L,$,C,I[h+4],O,3889429448),C=i(C,A,L,$,I[h+9],N,568446438),$=i($,C,A,L,I[h+14],j,3275163606),L=i(L,$,C,A,I[h+3],J,4107603335),A=i(A,L,$,C,I[h+8],O,1163531501),C=i(C,A,L,$,I[h+13],N,2850285829),$=i($,C,A,L,I[h+2],j,4243563512),L=i(L,$,C,A,I[h+7],J,1735328473),A=i(A,L,$,C,I[h+12],O,2368359562),C=s(C,A,L,$,I[h+5],P,4294588738),$=s($,C,A,L,I[h+8],R,2272392833),L=s(L,$,C,A,I[h+11],T,1839030562),A=s(A,L,$,C,I[h+14],b,4259657740),C=s(C,A,L,$,I[h+1],P,2763975236),$=s($,C,A,L,I[h+4],R,1272893353),L=s(L,$,C,A,I[h+7],T,4139469664),A=s(A,L,$,C,I[h+10],b,3200236656),C=s(C,A,L,$,I[h+13],P,681279174),$=s($,C,A,L,I[h+0],R,3936430074),L=s(L,$,C,A,I[h+3],T,3572445317),A=s(A,L,$,C,I[h+6],b,76029189),C=s(C,A,L,$,I[h+9],P,3654602809),$=s($,C,A,L,I[h+12],R,3873151461),L=s(L,$,C,A,I[h+15],T,530742520),A=s(A,L,$,C,I[h+2],b,3299628645),C=f(C,A,L,$,I[h+0],q,4096336452),$=f($,C,A,L,I[h+7],x,1126891415),L=f(L,$,C,A,I[h+14],D,2878612391),A=f(A,L,$,C,I[h+5],E,4237533241),C=f(C,A,L,$,I[h+12],q,1700485571),$=f($,C,A,L,I[h+3],x,2399980690),L=f(L,$,C,A,I[h+10],D,4293915773),A=f(A,L,$,C,I[h+1],E,2240044497),C=f(C,A,L,$,I[h+8],q,1873313359),$=f($,C,A,L,I[h+15],x,4264355552),L=f(L,$,C,A,I[h+6],D,2734768916),A=f(A,L,$,C,I[h+13],E,1309151649),C=f(C,A,L,$,I[h+4],q,4149444226),$=f($,C,A,L,I[h+11],x,3174756917),L=f(L,$,C,A,I[h+2],D,718787259),A=f(A,L,$,C,I[h+9],E,3951481745),C=e(C,v),A=e(A,S),L=e(L,m),$=e($,p);return(g(C)+g(A)+g(L)+g($)).toLowerCase()}angular.module("craft.auth.session",["craft.auth.handler","craft.auth.AuthService","craft.auth.UserStorage","craft.widgets.toast"]),angular.module("craft.auth.session").run(["$rootScope","$state","AuthHandlerService","SessionAuthService",function(r,t,e,n){r.$on("$stateChangeStart",function(r,t){n.isLoggedIn()||null!==t["protected"]&&t["protected"]===!0&&(r.preventDefault(),e.notLogonHandler())})}]),angular.module("craft.auth.session").controller("UserProfileCtrl",["$scope","SessionAuthService","AuthHandlerService","ngToast",r])}.call(),function(){"use strict";angular.module("craft.auth.UserStorage",[]).service("UserStorage",function(){this.create=function(r){localStorage.setItem("user",JSON.stringify(r))},this.retrieve=function(){return localStorage.getItem("user")},this.destroy=function(){localStorage.removeItem("user")}})}.call(this);